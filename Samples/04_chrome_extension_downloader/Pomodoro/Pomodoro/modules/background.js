(function(t){function e(e){for(var i,o,a=e[0],u=e[1],h=e[2],m=0,l=[];m<a.length;m++)o=a[m],r[o]&&l.push(r[o][0]),r[o]=0;for(i in u)Object.prototype.hasOwnProperty.call(u,i)&&(t[i]=u[i]);c&&c(e);while(l.length)l.shift()();return n.push.apply(n,h||[]),s()}function s(){for(var t,e=0;e<n.length;e++){for(var s=n[e],i=!0,a=1;a<s.length;a++){var u=s[a];0!==r[u]&&(i=!1)}i&&(n.splice(e--,1),t=o(o.s=s[0]))}return t}var i={},r={background:0},n=[];function o(e){if(i[e])return i[e].exports;var s=i[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=t,o.c=i,o.d=function(t,e,s){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(s,i,function(e){return t[e]}.bind(null,i));return s},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/modules/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],u=a.push.bind(a);a.push=e,a=a.slice();for(var h=0;h<a.length;h++)e(a[h]);var c=u;n.push([2,"chunk-vendors","chunk-common"]),s()})({2:function(t,e,s){t.exports=s("d70c")},4678:function(t,e,s){var i={"./af":"2bfb","./af.js":"2bfb","./ar":"8e73","./ar-dz":"a356","./ar-dz.js":"a356","./ar-kw":"423e","./ar-kw.js":"423e","./ar-ly":"1cfd","./ar-ly.js":"1cfd","./ar-ma":"0a84","./ar-ma.js":"0a84","./ar-sa":"8230","./ar-sa.js":"8230","./ar-tn":"6d83","./ar-tn.js":"6d83","./ar.js":"8e73","./az":"485c","./az.js":"485c","./be":"1fc1","./be.js":"1fc1","./bg":"84aa","./bg.js":"84aa","./bm":"a7fa","./bm.js":"a7fa","./bn":"9043","./bn.js":"9043","./bo":"d26a","./bo.js":"d26a","./br":"6887","./br.js":"6887","./bs":"2554","./bs.js":"2554","./ca":"d716","./ca.js":"d716","./cs":"3c0d","./cs.js":"3c0d","./cv":"03ec","./cv.js":"03ec","./cy":"9797","./cy.js":"9797","./da":"0f14","./da.js":"0f14","./de":"b469","./de-at":"b3eb","./de-at.js":"b3eb","./de-ch":"bb71","./de-ch.js":"bb71","./de.js":"b469","./dv":"598a","./dv.js":"598a","./el":"8d47","./el.js":"8d47","./en-SG":"cdab","./en-SG.js":"cdab","./en-au":"0e6b","./en-au.js":"0e6b","./en-ca":"3886","./en-ca.js":"3886","./en-gb":"39a6","./en-gb.js":"39a6","./en-ie":"e1d3","./en-ie.js":"e1d3","./en-il":"7333","./en-il.js":"7333","./en-nz":"6f50","./en-nz.js":"6f50","./eo":"65db","./eo.js":"65db","./es":"898b","./es-do":"0a3c","./es-do.js":"0a3c","./es-us":"55c9","./es-us.js":"55c9","./es.js":"898b","./et":"ec18","./et.js":"ec18","./eu":"0ff2","./eu.js":"0ff2","./fa":"8df4","./fa.js":"8df4","./fi":"81e9","./fi.js":"81e9","./fo":"0721","./fo.js":"0721","./fr":"9f26","./fr-ca":"d9f8","./fr-ca.js":"d9f8","./fr-ch":"0e49","./fr-ch.js":"0e49","./fr.js":"9f26","./fy":"7118","./fy.js":"7118","./ga":"5120","./ga.js":"5120","./gd":"f6b4","./gd.js":"f6b4","./gl":"8840","./gl.js":"8840","./gom-latn":"0caa","./gom-latn.js":"0caa","./gu":"e0c5","./gu.js":"e0c5","./he":"c7aa","./he.js":"c7aa","./hi":"dc4d","./hi.js":"dc4d","./hr":"4ba9","./hr.js":"4ba9","./hu":"5b14","./hu.js":"5b14","./hy-am":"d6b6","./hy-am.js":"d6b6","./id":"5038","./id.js":"5038","./is":"0558","./is.js":"0558","./it":"6e98","./it-ch":"6f12","./it-ch.js":"6f12","./it.js":"6e98","./ja":"079e","./ja.js":"079e","./jv":"b540","./jv.js":"b540","./ka":"201b","./ka.js":"201b","./kk":"6d79","./kk.js":"6d79","./km":"e81d","./km.js":"e81d","./kn":"3e92","./kn.js":"3e92","./ko":"22f8","./ko.js":"22f8","./ku":"2421","./ku.js":"2421","./ky":"9609","./ky.js":"9609","./lb":"440c","./lb.js":"440c","./lo":"b29d","./lo.js":"b29d","./lt":"26f9","./lt.js":"26f9","./lv":"b97c","./lv.js":"b97c","./me":"293c","./me.js":"293c","./mi":"688b","./mi.js":"688b","./mk":"6909","./mk.js":"6909","./ml":"02fb","./ml.js":"02fb","./mn":"958b","./mn.js":"958b","./mr":"39bd","./mr.js":"39bd","./ms":"ebe4","./ms-my":"6403","./ms-my.js":"6403","./ms.js":"ebe4","./mt":"1b45","./mt.js":"1b45","./my":"8689","./my.js":"8689","./nb":"6ce3","./nb.js":"6ce3","./ne":"3a39","./ne.js":"3a39","./nl":"facd","./nl-be":"db29","./nl-be.js":"db29","./nl.js":"facd","./nn":"b84c","./nn.js":"b84c","./pa-in":"f3ff","./pa-in.js":"f3ff","./pl":"8d57","./pl.js":"8d57","./pt":"f260","./pt-br":"d2d4","./pt-br.js":"d2d4","./pt.js":"f260","./ro":"972c","./ro.js":"972c","./ru":"957c","./ru.js":"957c","./sd":"6784","./sd.js":"6784","./se":"ffff","./se.js":"ffff","./si":"eda5","./si.js":"eda5","./sk":"7be6","./sk.js":"7be6","./sl":"8155","./sl.js":"8155","./sq":"c8f3","./sq.js":"c8f3","./sr":"cf1e","./sr-cyrl":"13e9","./sr-cyrl.js":"13e9","./sr.js":"cf1e","./ss":"52bd","./ss.js":"52bd","./sv":"5fbd","./sv.js":"5fbd","./sw":"74dc","./sw.js":"74dc","./ta":"3de5","./ta.js":"3de5","./te":"5cbb","./te.js":"5cbb","./tet":"576c","./tet.js":"576c","./tg":"3b1b","./tg.js":"3b1b","./th":"10e8","./th.js":"10e8","./tl-ph":"0f38","./tl-ph.js":"0f38","./tlh":"cf75","./tlh.js":"cf75","./tr":"0e81","./tr.js":"0e81","./tzl":"cf51","./tzl.js":"cf51","./tzm":"c109","./tzm-latn":"b53d","./tzm-latn.js":"b53d","./tzm.js":"c109","./ug-cn":"6117","./ug-cn.js":"6117","./uk":"ada2","./uk.js":"ada2","./ur":"5294","./ur.js":"5294","./uz":"2e8c","./uz-latn":"010e","./uz-latn.js":"010e","./uz.js":"2e8c","./vi":"2921","./vi.js":"2921","./x-pseudo":"fd7e","./x-pseudo.js":"fd7e","./yo":"7f33","./yo.js":"7f33","./zh-cn":"5c3a","./zh-cn.js":"5c3a","./zh-hk":"49ab","./zh-hk.js":"49ab","./zh-tw":"90ea","./zh-tw.js":"90ea"};function r(t){var e=n(t);return s(e)}function n(t){var e=i[t];if(!(e+1)){var s=new Error("Cannot find module '"+t+"'");throw s.code="MODULE_NOT_FOUND",s}return e}r.keys=function(){return Object.keys(i)},r.resolve=n,t.exports=r,r.id="4678"},d70c:function(t,e,s){"use strict";s.r(e);s("097d"),s("ac6a"),s("ac4d");class i{constructor(t,e){Object.is(e,void 0)||(this.value=e),this.symbol=Symbol.for(t),Object.freeze(this)}toString(){return this.symbol}valueOf(){return this.value}}class r{constructor(t){for(let e in t)this[e]=new i(e,t[e]);Object.freeze(this)}keys(){return Object.keys(this)}contains(t){return t instanceof i&&this[Symbol.keyFor(t.symbol)]===symbol}}var n=r,o=s("faa1"),a=s.n(o);const u=new n({Stopped:0,Running:1,Paused:2});class h extends a.a{constructor(t,e){super(),this.state=u.Stopped,this.duration=t,this.tick=e,this.tickInterval=null,this.expireTimeout=null,this.periodStartTime=null,this.remaining=null}observe(t){t.onStart&&this.on("start",(...e)=>t.onStart(...e)),t.onStop&&this.on("stop",(...e)=>t.onStop(...e)),t.onPause&&this.on("pause",(...e)=>t.onPause(...e)),t.onResume&&this.on("resume",(...e)=>t.onResume(...e)),t.onTick&&this.on("tick",(...e)=>t.onTick(...e)),t.onExpire&&this.on("expire",(...e)=>t.onExpire(...e)),t.onChange&&this.on("change",(...e)=>t.onChange(...e))}get isStopped(){return this.state===u.Stopped}get isRunning(){return this.state===u.Running}get isPaused(){return this.state===u.Paused}get timeRemaining(){if(!this.periodStartTime||!this.remaining)return null;let t=(Date.now()-this.periodStartTime)/1e3;return this.remaining-t}get timeElapsed(){return this.duration-this.timeRemaining}start(){this.isStopped&&(this.setExpireTimeout(this.duration),this.setTickInterval(this.tick),this.remaining=this.duration,this.state=u.Running,this.periodStartTime=Date.now(),this.emit("start",0,this.remaining),this.emit("change"))}stop(){this.isStopped||(clearInterval(this.tickInterval),clearTimeout(this.expireTimeout),this.tickInterval=null,this.expireTimeout=null,this.periodStartTime=null,this.remaining=null,this.state=u.Stopped,this.emit("stop"),this.emit("change"))}pause(){if(!this.isRunning)return;clearInterval(this.tickInterval),clearTimeout(this.expireTimeout);let t=(Date.now()-this.periodStartTime)/1e3;this.remaining-=t,this.state=u.Paused,this.periodStartTime=null;let e=this.duration-this.remaining;this.emit("pause",e,this.remaining),this.emit("change")}resume(){if(!this.isPaused)return;this.setExpireTimeout(this.remaining),this.setTickInterval(this.tick),this.state=u.Running,this.periodStartTime=Date.now();let t=this.duration-this.remaining;this.emit("resume",t,this.remaining),this.emit("change")}reset(){this.stop(),this.start()}setExpireTimeout(t){this.expireTimeout=setTimeout(()=>{clearInterval(this.tickInterval),clearTimeout(this.expireTimeout),this.tickInterval=null,this.expireTimeout=null,this.periodStartTime=null,this.remaining=null,this.state=u.Stopped,this.emit("expire",this.duration,0),this.emit("change")},1e3*t)}setTickInterval(t){this.tickInterval=setInterval(()=>{let t=(Date.now()-this.periodStartTime)/1e3,e=this.remaining-t,s=this.duration-e;this.emit("tick",s,e)},1e3*t)}}const c=new n({Focus:0,ShortBreak:1,LongBreak:2});class m extends a.a{constructor(t,e=c.Focus,s=h){super(),this.timerType=s,this.advanceTimer=!1,this.pomodoros=0,this.settings=t,this.phase=e}_updateTimer(){let{duration:t}={[c.Focus]:this.settings.focus,[c.ShortBreak]:this.settings.shortBreak,[c.LongBreak]:this.settings.longBreak}[this.phase];this.timer&&(this.timer.stop(),this.timer.removeAllListeners()),this.timer=new this.timerType(Math.floor(60*t),60),this.timer.observe(this)}get phase(){return this._phase}set phase(t){if(!this.hasLongBreak&&t===c.LongBreak)throw new Error("No long break interval defined.");this._phase=t,this._updateTimer(),this.advanceTimer=!1}get nextPhase(){return this.phase===c.ShortBreak||this.phase===c.LongBreak?c.Focus:this.hasLongBreak&&0===this.pomodorosUntilLongBreak?c.LongBreak:c.ShortBreak}get hasLongBreak(){return this.settings.longBreak.interval>0}get pomodorosUntilLongBreak(){let{interval:t}=this.settings.longBreak;return t?t-(this.pomodoros-1)%t-1:null}get timeRemaining(){return this.timer.timeRemaining}get timeElapsed(){return this.timer.timeElapsed}get state(){return this.timer.state}get isRunning(){return this.timer.isRunning}get isStopped(){return this.timer.isStopped}get isPaused(){return this.timer.isPaused}dispose(){this.timer.stop(),this.timer.removeAllListeners()}startCycle(){this.pomodoros=0,this.phase=c.Focus,this.start()}startFocus(){this.phase=c.Focus,this.start()}startShortBreak(){this.phase=c.ShortBreak,this.start()}startLongBreak(){this.phase=c.LongBreak,this.start()}start(){this.advanceTimer&&(this._phase=this.nextPhase,this.advanceTimer=!1),this._updateTimer(),this.timer.start()}pause(){return this.timer.pause()}stop(){return this.timer.stop()}resume(){return this.timer.resume()}reset(){return this.timer.reset()}observe(t){t.onTimerStart&&this.on("timer:start",(...e)=>t.onTimerStart(...e)),t.onTimerStop&&this.on("timer:stop",(...e)=>t.onTimerStop(...e)),t.onTimerPause&&this.on("timer:pause",(...e)=>t.onTimerPause(...e)),t.onTimerResume&&this.on("timer:resume",(...e)=>t.onTimerResume(...e)),t.onTimerTick&&this.on("timer:tick",(...e)=>t.onTimerTick(...e)),t.onTimerExpire&&this.on("timer:expire",(...e)=>t.onTimerExpire(...e)),t.onTimerChange&&this.on("timer:change",(...e)=>t.onTimerChange(...e))}onStart(...t){this.emit("timer:start",...[this.phase,this.nextPhase,...t])}onStop(...t){this.emit("timer:stop",...[this.phase,this.nextPhase,...t])}onPause(...t){this.emit("timer:pause",...[this.phase,this.nextPhase,...t])}onResume(...t){this.emit("timer:resume",...[this.phase,this.nextPhase,...t])}onTick(...t){this.emit("timer:tick",...[this.phase,this.nextPhase,...t])}onExpire(...t){this.phase===c.Focus&&this.pomodoros++,this.advanceTimer=!0,this.emit("timer:expire",...[this.phase,this.nextPhase,...t])}onChange(...t){this.emit("timer:change",...[this.phase,this.nextPhase,...t])}}var l=s("a0ef"),d=s("0567"),p=s("dcb2");class g{constructor(t,...e){this.contexts=t,this.groups=e}addGroup(t){this.groups.push(t)}apply(){chrome.contextMenus.removeAll();let t=!0;for(let e of this.groups){let s=!0;for(let i of e.items)if(i.visible)if(s&&!t&&chrome.contextMenus.create({type:"separator",contexts:this.contexts}),t=!1,s=!1,i instanceof b){let t=chrome.contextMenus.create({title:i.title,contexts:this.contexts});for(let e of i.children)e.visible&&chrome.contextMenus.create({title:e.title,contexts:this.contexts,onclick:()=>e.run(),parentId:t})}else chrome.contextMenus.create({title:i.title,contexts:this.contexts,onclick:()=>i.run()})}}}class f{constructor(...t){this.items=t}addItem(t){this.items.push(t)}}class b{constructor(...t){this.children=t}addChild(t){this.children.push(t)}get title(){return""}get visible(){return!1}}class w extends b{constructor(...t){super(...t)}get title(){return d["a"].restart_timer}get visible(){return!0}}class k{get title(){return""}get visible(){return!1}run(){}}class j extends k{constructor(t){super(),this.timer=t}get title(){return d["a"].start_focusing}get visible(){return!0}run(){this.timer.startFocus()}}class v extends k{constructor(t){super(),this.timer=t}get title(){return this.timer.hasLongBreak?d["a"].start_short_break:d["a"].start_break}get visible(){return!0}run(){this.timer.startShortBreak()}}class y extends k{constructor(t){super(),this.timer=t}get title(){return d["a"].start_long_break}get visible(){return this.timer.hasLongBreak}run(){this.timer.startLongBreak()}}class _ extends k{constructor(t){super(),this.timer=t}get title(){return d["a"].stop_timer}get visible(){return this.timer.isRunning||this.timer.isPaused}run(){this.timer.stop()}}class x extends k{constructor(t){super(),this.timer=t}get title(){return d["a"].pause_timer}get visible(){return this.timer.isRunning}run(){this.timer.pause()}}class S extends k{constructor(t){super(),this.timer=t}get title(){return d["a"].resume_timer}get visible(){return this.timer.isPaused}run(){this.timer.resume()}}class T extends k{constructor(){super()}get title(){return d["a"].pomodoro_history}get visible(){return!0}async run(){let t=new p["c"];await t.showHistoryPage(),t.dispose()}}class B extends k{constructor(t){super(),this.timer=t}get title(){return this.timer.isRunning||this.timer.isPaused?d["a"].restart_pomodoro_cycle:d["a"].start_pomodoro_cycle}get visible(){return this.timer.hasLongBreak}run(){this.timer.startCycle()}}class z{constructor(t,e,s){this.timer=t,this.inactive=e,this.active=s}apply(){let t=this.timer.isRunning||this.timer.isPaused?this.active:this.inactive;t.apply()}}function L(t){let e=new x(t),s=new S(t),i=new _(t),r=new B(t),n=new j(t),o=new v(t),a=new y(t),u=new T,h=new g(["browser_action"],new f(r,n,o,a),new f(u)),c=new g(["browser_action"],new f(e,s,i,new w(n,o,a),r),new f(u));return new z(t,h,c)}class P extends a.a{constructor(t,e){super(),this.schema=t,this.storage=e}async get(){let[t,e]=this._upgrade(await this.storage.get());return e&&(await this.storage.clear(),await this.storage.set(t)),t}async set(t){var[t,e]=this._upgrade(t);await this.storage.set(t),this.emit("change",t)}_upgrade(t){let e=!1;if(0===Object.keys(t).length&&(e=!0,t=this.schema.default),!t.version)throw new Error("Missing version.");if(t.version<this.schema.version){e=!0;for(let e=t.version;e<this.schema.version;++e){let s=`from${e}To${e+1}`;if(t=this.schema[s](t),t.version!==e+1)throw new Error("Unexpected version.")}}return[t,e]}}var E=P;class I{static compress(t){let e=[],s=0,i=t[0];for(let r=1;r<=t.length;++r)t[r]!==i&&(e.push(r-s),e.push(i),s=r,i=t[r]);return e}static decompress(t){let e=[];for(let s=0;s<t.length;s+=2)for(let i=0;i<t[s];++i)e.push(t[s+1]);return e}static append(t,e){return t.length>0&&e===t[t.length-1]?t[t.length-2]++:t.push(1,e),t}}var C=I,D=s("48d2"),O=s("c1df"),R=s.n(O);class A{constructor(){this.storage=new E(new F,l["a"].storage.local),this.mutex=new D["a"]}async all(){return await this.storage.get()}async clear(){await this.storage.set(this.storage.schema.default)}async merge(t){return await this.mutex.exclusive(async()=>{let e=N(await this.storage.get()),s=N(t),{count:i,merged:r}=H(e,s);return await this.storage.set(U(r)),i})}async toCSV(){let{pomodoros:t,durations:e,timezones:s}=N(await this.storage.get());const i=t=>{return t.indexOf(",")<0?t:'"'+t.replace(/"/g,'""')+'"'},r=t=>t.map(t=>i(t.toString())).join(",")+"\n";let n=r([d["a"].end_iso_8601,d["a"].end_date,d["a"].end_time,d["a"].end_timestamp,d["a"].end_timezone,d["a"].duration_seconds]);for(let o=0;o<t.length;o++){let[i,a]=[60*t[o],-s[o]],u=R.a.unix(i).utcOffset(a,!0);n+=r([u.toISOString(!0),u.format("YYYY-MM-DD"),u.format("HH:mm:ss"),i,a,e[o]])}return n}async addPomodoro(t,e=null){await this.mutex.exclusive(async()=>{let s=await this.storage.get();e=e||new Date;let i=A.timestamp(e),r=s.pomodoros.length-1;while(r>=0&&s.pomodoros[r]>i)--r;let n=e.getTimezoneOffset();if(r>=s.pomodoros.length-1)C.append(s.durations,t),C.append(s.timezones,n),s.pomodoros.push(i);else{let e=C.decompress(s.durations);e.splice(r+1,0,t),s.durations=C.compress(e);let o=C.decompress(s.timezones);o.splice(r+1,0,n),s.timezones=C.compress(o),s.pomodoros.splice(r+1,0,i)}return await this.storage.set(s),this.countSince(s.pomodoros,A.today)})}async stats(t){return this.mutex.exclusive(async()=>{let{pomodoros:e}=await this.storage.get("pomodoros"),s=e.length,i=0===s?0:new Date-A.date(e[0]),r=Math.max(i/1e3/60/60/24,1),n=Math.max(r/7,1),o=Math.max(r/30.4375,1);return{day:this.countSince(e,A.today),dayAverage:s/r,week:this.countSince(e,A.thisWeek),weekAverage:s/n,month:this.countSince(e,A.thisMonth),monthAverage:s/o,period:this.countSince(e,new Date(t)),total:s,daily:this.dailyGroups(e,t),pomodoros:e.map(t=>+A.date(t))}})}async countToday(t=null){return this.mutex.exclusive(async()=>{return t||(t=(await this.storage.get("pomodoros")).pomodoros,0!==t.length)?this.countSince(t,A.today):0})}countSince(t,e){let s=A.timestamp(e),i=G(t,s);return t.length-i}dailyGroups(t,e){let s=new Date(e),i={},r=0,n=A.today;while(n>=s){let e=this.countSince(t,n),s=e-r;s>0&&(i[+n]=s,r=e),n.setDate(n.getDate()-1)}return i}static timestamp(t){return Math.floor(+t/1e3/60)}static date(t){return new Date(60*t*1e3)}static get today(){let t=new Date;return t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t}static get thisWeek(){let t=new Date;return t.setDate(t.getDate()-t.getDay()),t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t}static get thisMonth(){let t=new Date;return t.setDate(1),t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t}}class F{get version(){return 1}get default(){return{pomodoros:[],durations:[],timezones:[],version:this.version}}}function N(t){if(!t)throw new Error(d["a"].missing_pomodoro_data);let{pomodoros:e,durations:s,timezones:i}=t;if(!e)throw new Error(d["a"].missing_pomodoro_data);if(!s)throw new Error(d["a"].missing_duration_data);if(!Array.isArray(s))throw new Error(d["a"].invalid_duration_data);if(!i)throw new Error(d["a"].missing_timezone_data);if(!Array.isArray(i))throw new Error(d["a"].missing_timezone_data);const r=C.decompress(s),n=C.decompress(i);if(e.length!==r.length)throw new Error(d["a"].mismatched_pomodoro_duration_data);if(e.length!==n.length)throw new Error(d["a"].mismatched_pomodoro_timezone_data);for(let o=0;o<e.length;o++){if(!Number.isInteger(e[o]))throw new Error(d["a"].invalid_pomodoro_data);if(!Number.isInteger(r[o]))throw new Error(d["a"].invalid_duration_data);if(!Number.isInteger(n[o]))throw new Error(d["a"].invalid_timezone_data)}return{...t,pomodoros:e,durations:r,timezones:n}}function U(t){if(!t)throw new Error(d["a"].missing_pomodoro_data);if(!t.durations)throw new Error(d["a"].missing_duration_data);if(!Array.isArray(t.durations))throw new Error(d["a"].invalid_duration_data);if(!t.timezones)throw new Error(d["a"].missing_timezone_data);if(!Array.isArray(t.timezones))throw new Error(d["a"].invalid_timezone_data);return{...t,durations:C.compress(t.durations),timezones:C.compress(t.timezones)}}function H(t,e){let{pomodoros:s,durations:i,timezones:r}=t,{pomodoros:n,durations:o,timezones:a}=e,u=[...s],h=[...i],c=[...r],m=0;for(let l=0;l<n.length;l++){let t=n[l],e=G(u,t);u[e]!==t&&(m++,u.splice(e,0,t),h.splice(e,0,o[l]),c.splice(e,0,a[l]))}return{count:m,merged:{...t,pomodoros:u,durations:h,timezones:c}}}function G(t,e,s=null,i=null){s=s||0,i=i||t.length-1;while(s<=i){let r=Math.floor((s+i)/2);t[r]>=e?i=r-1:t[r]<e&&(s=r+1)}return Math.min(s,t.length)}function q(t){if(t instanceof Array){let e=[];for(let s of t)e.push(q(s));return e}if(t instanceof Object){let e={};for(let s in t)e[s]=q(t[s]);return e}return t}class Y{get version(){return 6}get default(){return{focus:{duration:25,timerSound:null,notifications:{desktop:!0,tab:!0,sound:null}},shortBreak:{duration:5,timerSound:null,notifications:{desktop:!0,tab:!0,sound:null}},longBreak:{duration:15,interval:4,timerSound:null,notifications:{desktop:!0,tab:!0,sound:null}},autostart:{time:null},version:this.version}}from1To2(t){return{focus:{duration:t.focus.duration,notifications:{desktop:t.focus.desktopNotification,tab:t.focus.newTabNotification,sound:t.focus.sound?new URL(t.focus.sound).pathname:null}},shortBreak:{duration:t.break.duration,notifications:{desktop:t.break.desktopNotification,tab:t.break.newTabNotification,sound:t.break.sound?new URL(t.break.sound).pathname:null}},longBreak:{duration:15,interval:4,notifications:{desktop:t.break.desktopNotification,tab:t.break.newTabNotification,sound:t.break.sound?new URL(t.break.sound).pathname:null}},version:2}}from2To3(t){const e={"/audio/battle-horn.mp3":"/audio/88736c22.mp3","/audio/bell-ring.mp3":"/audio/b10d75f2.mp3","/audio/bike-horn.mp3":"/audio/72312dd3.mp3","/audio/computer-magic.mp3":"/audio/5cf807ce.mp3","/audio/din-ding.mp3":"/audio/72cb1b7f.mp3","/audio/ding-dong.mp3":"/audio/92ff2a8a.mp3","/audio/ding.mp3":"/audio/1a5066bd.mp3","/audio/dong.mp3":"/audio/5e122cee.mp3","/audio/electronic-chime.mp3":"/audio/28d6b5be.mp3","/audio/fire-pager.mp3":"/audio/b38e515f.mp3","/audio/glass-ping.mp3":"/audio/2ed9509e.mp3","/audio/gong-1.mp3":"/audio/8bce59b5.mp3","/audio/gong-2.mp3":"/audio/85cab25d.mp3","/audio/music-box.mp3":"/audio/ebe7deb8.mp3","/audio/pin-dropping.mp3":"/audio/2e13802a.mp3","/audio/reception-bell.mp3":"/audio/54b867f9.mp3","/audio/robot-blip-1.mp3":"/audio/bd50add0.mp3","/audio/robot-blip-2.mp3":"/audio/36e93c27.mp3","/audio/ship-bell.mp3":"/audio/9404f598.mp3","/audio/toaster-oven.mp3":"/audio/a258e906.mp3","/audio/tone.mp3":"/audio/f62b45bc.mp3","/audio/train-horn.mp3":"/audio/6a215611.mp3"};let s=q(t);s.version=3;for(let i of[s.focus,s.shortBreak,s.longBreak].map(t=>t.notifications))if(i.sound){let t=e[i.sound.toLowerCase()];i.sound=t||i.sound}return s}from3To4(t){let e=q(t);return e.version=4,e.focus.timerSound=null,e.shortBreak.timerSound=null,e.longBreak.timerSound=null,e}from4To5(t){let e=q(t);return e.version=5,e.autostart={time:null},e}from5To6(t){let e=q(t);return e.version=6,e.focus.timerSound&&(e.focus.timerSound={metronome:e.focus.timerSound}),e}}class J{static async create(t){let e=await t.get();return t.on("change",t=>e=t),new Proxy(function(){},{get(t,s,i){return e[s]}})}}var W=s("583d"),$=s("9f6b");class V{constructor(t,e,s=null){this.title=t,this.message=e,this.buttons=[],this.notificationId=null,this.onClick=s}addButton(t,e){this.buttons.push({title:t,onClick:e})}async show(){if(null!=this.notificationId)return;let t={type:"basic",title:this.title,message:this.message,iconUrl:"images/128.png",isClickable:!!this.action,requireInteraction:!0,buttons:this.buttons.map(t=>{return{title:t.title,iconUrl:"images/start.png"}})};this.notificationId=await l["a"].notifications.create(t);let e=t=>{t===this.notificationId&&(this.onClick&&this.onClick(),chrome.notifications.clear(t))},s=(t,e)=>{t===this.notificationId&&(this.buttons[e].onClick(),chrome.notifications.clear(t))},i=t=>{t===this.notificationId&&(chrome.notifications.onClicked.removeListener(e),chrome.notifications.onButtonClicked.removeListener(s),chrome.notifications.onClosed.removeListener(i),this.notificationId=null)};chrome.notifications.onClicked.addListener(e),chrome.notifications.onButtonClicked.addListener(s),chrome.notifications.onClosed.addListener(i)}close(){null!=this.notificationId&&chrome.notifications.clear(this.notificationId)}}var K=V,Q=s("b376"),X=s("2354");class Z{onTimerStart(t,e,s,i){this.updateBadge({phase:t,minutes:Math.round(i/60)})}onTimerTick(t,e,s,i){this.updateBadge({phase:t,minutes:Math.round(i/60)})}onTimerStop(t,e){this.removeBadge()}onTimerPause(t,e){this.updateBadge({phase:t,text:"—",tooltip:d["a"].timer_paused})}onTimerResume(t,e,s,i){this.updateBadge({phase:t,minutes:Math.round(i/60)})}onTimerExpire(t,e){this.removeBadge()}updateBadge({phase:t,minutes:e,tooltip:s,text:i}){let r={[c.Focus]:d["a"].focus_title,[c.ShortBreak]:d["a"].short_break_title,[c.LongBreak]:d["a"].long_break_title}[t];null!=e?(i=e<1?d["a"].less_than_minute:d["a"].n_minutes(e),s=d["a"].browser_action_tooltip(r,d["a"].time_remaining(i))):s=d["a"].browser_action_tooltip(r,s);let n=t===c.Focus?"#bb0000":"#11aa11";chrome.browserAction.setTitle({title:s}),chrome.browserAction.setBadgeText({text:i}),chrome.browserAction.setBadgeBackgroundColor({color:n})}removeBadge(){chrome.browserAction.setTitle({title:""}),chrome.browserAction.setBadgeText({text:""})}}class tt{constructor(t){this.settings=t,this.mutex=new D["a"],this.timerSound=null}async onTimerStart(t){let e=this.settings.focus.timerSound;await this.mutex.exclusive(async()=>{this.timerSound&&await this.timerSound.close(),t===c.Focus&&e?(this.timerSound=await Object(X["a"])(e),this.timerSound.start()):this.timerSound=null})}async onTimerStop(){await this.mutex.exclusive(async()=>{this.timerSound&&await this.timerSound.close()})}async onTimerPause(){await this.mutex.exclusive(async()=>{this.timerSound&&await this.timerSound.stop()})}async onTimerResume(){await this.mutex.exclusive(async()=>{this.timerSound&&await this.timerSound.start()})}async onTimerExpire(){await this.mutex.exclusive(async()=>{this.timerSound&&await this.timerSound.close()})}}class et{constructor(t){this.settings=t}onTimerExpire(t){let e=t=>t&&t.notifications.sound,s={[c.Focus]:e(this.settings.focus),[c.ShortBreak]:e(this.settings.shortBreak),[c.LongBreak]:e(this.settings.longBreak)}[t];s&&$["b"](s)}}class st{constructor(t,e,s){this.timer=t,this.settings=e,this.history=s,this.notification=null,this.expiration=null,this.mutex=new D["a"]}onTimerStart(){this.mutex.exclusive(async()=>{this.notification&&(this.notification.close(),this.notification=null),this.expiration&&(this.expiration.close(),this.expiration=null)})}async onTimerExpire(t,e){let s=this.settings[{[c.Focus]:"focus",[c.ShortBreak]:"shortBreak",[c.LongBreak]:"longBreak"}[t]],i=this.timer.hasLongBreak,r={[c.Focus]:d["a"].start_focusing,[c.ShortBreak]:i?d["a"].take_a_short_break:d["a"].take_a_break,[c.LongBreak]:d["a"].take_a_long_break}[e],n={[c.Focus]:d["a"].start_focusing_now,[c.ShortBreak]:i?d["a"].start_short_break_now:d["a"].start_break_now,[c.LongBreak]:d["a"].start_long_break_now}[e],o={[c.Focus]:d["a"].start_focusing,[c.ShortBreak]:i?d["a"].start_short_break:d["a"].start_break,[c.LongBreak]:d["a"].start_long_break}[e],a=[],u=this.timer.pomodorosUntilLongBreak;u>0&&a.push(d["a"].pomodoros_until_long_break(Object(W["c"])(u)));let h=await this.history.countToday();a.push(d["a"].pomodoros_completed_today(Object(W["c"])(h))),a=a.filter(t=>!!t),await this.mutex.exclusive(async()=>{if(s.notifications.desktop&&(this.notification=new K(r,a.join("\n"),()=>this.timer.start()),this.notification.addButton(n,()=>this.timer.start()),await this.notification.show()),s.notifications.tab){let t={[c.Focus]:"focus",[c.ShortBreak]:i?"short-break":"break",[c.LongBreak]:"long-break"}[e];this.expiration=await Q["b"].show(r,a,o,h,t)}})}}class it{constructor(t){this.history=t}async onTimerExpire(t,e,s){t===c.Focus&&await this.history.addPomodoro(s)}}class rt{constructor(t){this.menu=t}onTimerChange(){this.menu.apply()}}var nt=s("bb42");let ot=null,at=new D["a"];async function ut(t,e){ot=await e.get(),e.on("change",async t=>{ot=t,await ht(ot)}),chrome.alarms.onAlarm.addListener(e=>ct(e,t)),await ht(ot)}async function ht(t){await at.exclusive(async()=>{await l["a"].alarms.clearAll();let e=t.autostart&&t.autostart.time;if(!e)return;const s=new Date;let i=new Date;i.setHours(...e.split(":"),0,0),i<=s&&i.setDate(i.getDate()+1),l["a"].alarms.create("autostart",{when:+i})})}async function ct(t,e){"autostart"===t.name&&(await ht(ot),e.isStopped&&(e.startCycle(),l["a"].notifications.create({type:"basic",title:M.autostart_notification_title,message:M.autostart_notification_message,iconUrl:"images/128.png",isClickable:!1,requireInteraction:!0})))}class mt{static run(t,e,s,i){return new mt(t,e,s,i)}constructor(t,e,s,i){this.settings=s,this.history=i,this.timer=t,this.menu=L(this.timer),this.timer.observe(new it(i)),this.timer.observe(new Z),this.timer.observe(new st(t,s,i)),this.timer.observe(new et(s)),this.timer.observe(new tt(s)),this.timer.observe(new rt(this.menu)),this.menu.apply(),e.on("change",()=>this.menu.apply()),ut(t,e),chrome.browserAction.onClicked.addListener(()=>this.onBrowserAction())}onBrowserAction(){this.timer.isRunning?this.timer.pause():this.timer.isPaused?this.timer.resume():this.timer.start()}}async function lt(){let t=new E(new Y,l["a"].storage.sync),e=await J.create(t),s=new m(e),i=new A;mt.run(s,t,e,i),nt["b"].register(new p["b"](i)),nt["b"].register(new p["j"]),nt["b"].register(new p["h"](t)),nt["b"].register(new p["f"](s)),nt["b"].register(new p["d"])}lt()}});